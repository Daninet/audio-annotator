(this["webpackJsonpaudio-annotator"]=this["webpackJsonpaudio-annotator"]||[]).push([[0],{23:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),o=n(8),u=n.n(o),a=n(3),i=n(4),s=n(13),l=n(5),d=n(10),j=n.n(d),b=n(7),f=n(11),O=n.n(f),v=n(12),g=n.n(v),p=n(1),h=null,m=function(e){var t=e.file,n=Object(r.useState)(""),c=Object(i.a)(n,2),o=c[0],u=c[1],s=Object(r.useState)([]),d=Object(i.a)(s,2),f=d[0],v=d[1],m=Object(r.useState)(null),x=Object(i.a)(m,2),y=x[0],E=x[1],S=Object(r.useState)({}),k=Object(i.a)(S,2),R=k[0],C=k[1],w=Object(r.useRef)(null),P=Object(r.useRef)(null),D=Object(r.useRef)(null),L=Object(r.useRef)(null),M=Object(r.useRef)(),z=function(){if(!M.current)return v([]);for(var e=M.current.regions.list,t=[],n=0,r=Object.keys(e);n<r.length;n++){var c=r[n],o=e[c];t.push({start:o.start,end:o.end,key:c}),console.log(o)}return t.sort((function(e,t){return e.start-t.start})),v(t)},T=function(e){console.log("onEnterRegion",e),E(e)},B=function(e){console.log("onLeaveRegion",e),E(null)},I=function(){var e=M.current.getCurrentTime();console.log("onSeek",e);var t=Object.values(M.current.regions.list).find((function(t){return t.start<=e&&t.end>=e}));E(t||null)},J=function(){console.log("onZoom")};Object(r.useEffect)((function(){M.current=j.a.create({container:w.current,waveColor:"green",progressColor:"blue",scrollParent:!0,partialRender:!0,plugins:[O.a.create(),g.a.create({container:P.current})]});var e=Object(b.debounce)(z,25);return M.current.on("region-created",e),M.current.on("region-updated",e),M.current.on("region-updated-end",e),M.current.on("region-removed",e),M.current.on("region-in",T),M.current.on("region-out",B),M.current.on("seek",I),M.current.on("zoom",J),M.current.loadBlob(t),function(){return M.current.destroy()}}),[t]);Object(r.useEffect)((function(){var e=function(e){return"Space"===e?(M.current.isPlaying()?M.current.pause():M.current.play(),!0):("Enter"===e&&function(){var e=M.current;if(h){var t=h.start,n=e.getCurrentTime();h.remove(),e.addRegion({start:Math.min(t,n),end:Math.max(t,n),drag:!0,resize:!0}),h=null}else{var r=e.addRegion({start:e.getCurrentTime(),end:e.getCurrentTime(),drag:!0,resize:!0});h=r}console.log(e.regions.list)}(),!1)},t=function(t){t.ctrlKey||t.shiftKey||t.altKey||t.repeat||e(t.code)&&(t.preventDefault(),t.stopPropagation())};return document.addEventListener("keydown",t),function(){return document.removeEventListener("keydown",t)}}),[]);Object(r.useEffect)((function(){var e;if(!y)return u("");u(null!==(e=R[y.id])&&void 0!==e?e:""),setTimeout((function(){L.current&&L.current.focus()}),0)}),[R,y]);Object(r.useEffect)((function(){var e=Object(b.debounce)((function(e){var t;if(["WAVE","REGION"].includes(null===(t=e.target)||void 0===t?void 0:t.tagName)&&e.deltaY){var n=-1*Math.sign(e.deltaY);if(M.current){var r=Math.max(20,M.current.params.minPxPerSec+50*n);M.current.params.minPxPerSec!==r&&M.current.zoom(r)}}}),100);return document.addEventListener("wheel",e),function(){return document.removeEventListener("wheel",e)}}),[]);var K="[\n".concat(f.map((function(e){var t;return"  [".concat(e.start,", ").concat(e.end,", ").concat(JSON.stringify(null!==(t=R[e.key])&&void 0!==t?t:""),"]")})).join("\n"),"\n]");return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{ref:w}),Object(p.jsx)("div",{ref:P}),Object(p.jsx)("div",{ref:D}),Object(p.jsx)("br",{}),y?Object(p.jsxs)("p",{children:["Current: (",null===y||void 0===y?void 0:y.start,", ",null===y||void 0===y?void 0:y.end,")\xa0",Object(p.jsx)("button",{onClick:function(){return e=y,E(null),void e.remove();var e},children:"Delete"}),Object(p.jsx)("br",{}),"Label: ",Object(p.jsx)("input",{ref:L,value:o,onChange:function(e){return function(e){var t=y.id;C((function(n){return Object(a.a)(Object(a.a)({},n),{},Object(l.a)({},t,e))}))}(e.target.value)},readOnly:null===y})]}):null,Object(p.jsx)("p",{children:"Space = play / pause"}),Object(p.jsx)("p",{children:"Mouse wheel = zoom"}),Object(p.jsx)("p",{children:"Enter = start / end region"}),Object(p.jsx)("textarea",{rows:20,cols:90,readOnly:!0,value:K})]})};var x=function(){var e=Object(r.useState)(null),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(r.useCallback)((function(e){c(e[0]),console.log(e[0])}),[]),u=Object(s.a)({onDrop:o,maxFiles:1}),l=u.getRootProps,d=u.getInputProps,j=u.isDragActive;return Object(p.jsxs)("div",{children:[Object(p.jsx)("h2",{children:"Simple audio annotator"}),n?Object(p.jsx)(m,{file:n}):Object(p.jsxs)("div",Object(a.a)(Object(a.a)({},l()),{},{style:{height:300,border:"1px solid gray",padding:20},children:[Object(p.jsx)("input",Object(a.a)({},d())),j?Object(p.jsx)("p",{children:"Drop the files here ..."}):Object(p.jsx)("p",{children:"Drag 'n' drop some audio files here, or click to select files"})]})),Object(p.jsx)("br",{}),Object(p.jsx)("sub",{children:"\xa9 2021 Dani Biro"})]})};u.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(x,{})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.0bb68925.chunk.js.map